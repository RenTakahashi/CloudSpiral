<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"/>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous"/>
    <script src="js/common.js"></script>
    <link rel="stylesheet" href="css/common.css"/>
    <title>旅行記作成</title>
    <style>
        .img-keep-ratio {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
        }

        .photo-description {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;	/* 3行分 */
            line-height: 1.5;
            height: 4.5rem;	/* = (number of visible lines) * (line-height) * 1rem */
            overflow: hidden;
        }

        .font-size-4x {
            font-size: 4rem;
        }
    </style>
    <script>
        function initMap() {
            const defaultLocation = {lat: -34.397, lng: 150.644};	// TODO: 初期値は現在地

            // 旅程プレビュー用地図
            let mapPreview = new google.maps.Map(document.getElementById('map-preview'), {
                center: defaultLocation,
                zoom: 10
            });
            new google.maps.Marker({
                position: defaultLocation,
                map: mapPreview,
                title: 'Hello World!'
            });
        }

        function adjustMapSize() {
            $('[id^=map-]').each(function(i) {
                $(this).height($(this).width() * 0.75);
            });
        }

        function clearInputData() {
            console.log('ここで入力データをクリアする');
        }

        $(window).resize(function() {
            adjustMapSize();
        });

        $(document).ready(function(){
            initTemplate('旅行記作成', '<span class="fas fa-upload"></span> 投稿');

            adjustMapSize();

            $('#add-photo-modal').on('shown.bs.modal', function() {
                adjustMapSize();
            });

            // ファイル選択ボタンがタップされたらファイル選択ダイアログを開く
            $('#select-photo-button').on('click', function() {
                $('#file-input').click();
            });

            $('#file-input').on('change', function(event) {
                console.log('ここで選択されたファイルを取得する');
                console.log(event.target.files);

                $('.photo-property-form').removeClass('d-none');
                $('.photo-property-form').addClass('d-flex');
            });

            $('#photo-taken-location').on('click', function() {
                console.log('ここで撮影場所指定モーダルを表示する');
            });

            $('#reset-photo-button').on('click', function() {
                $('.photo-property-form').removeClass('d-flex');
                $('.photo-property-form').addClass('d-none');

                clearInputData();
            });

            $('#add-photo-button').on('click', function() {
                console.log('ここで POST /api/photos する');

                clearInputData();
            });
        });
    </script>
</head>
<body>
<main class="container-fluid">

    <div class="row">
        <div class="col">
            <form class="form-group mb-4">
                <input type="text" id="travelogue-title" class="form-control form-control-lg" placeholder="タイトル">
            </form>

            <div id="photo-list" class="form-group mb-4">
                <!-- TODO: ここをJSで生成する -->
                <div class="card my-2 px-1">
                    <div class="row" style="height: 10rem">
                        <div class="col d-flex h-100">
                            <img src="DSC_0072.JPG" class="img-keep-ratio m-auto"/>
                        </div>
                        <div class="col my-auto">
                            <p class="card-text photo-description mb-1">
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                                exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure
                                dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                                Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt
                                mollit anim id est laborum.
                            </p>
                            <p class="my-1">
                                <span class="fas fa-clock d-inline-block text-center" title="撮影日時"
                                      style="width: 1rem"></span>
                                xxxx/xx/xx xx:xx
                            </p>
                            <p class="mt-1 mb-0">
                                <span class="fas fa-map-marker-alt d-inline-block text-center" title="撮影場所"
                                      style="width: 1rem"></span>
                                (xx.xxxx, xx.xxxx) <!-- TODO: 逆引きする？ -->
                            </p>
                        </div>
                    </div>
                </div>
                <div class="card my-2 px-1">
                    <div class="row" style="height: 10rem">
                        <div class="col d-flex h-100">
                            <img src="20181104_003_small.jpg" class="img-keep-ratio m-auto"/>
                        </div>
                        <div class="col my-auto">
                            <p class="card-text photo-description mb-1">
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                                exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure
                                dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                                Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt
                                mollit anim id est laborum.
                            </p>
                            <p class="my-1">
                                <span class="fas fa-clock d-inline-block text-center" title="撮影日時"
                                      style="width: 1rem"></span>
                                xxxx/xx/xx xx:xx
                            </p>
                            <p class="mt-1 mb-0">
                                <span class="fas fa-map-marker-alt d-inline-block text-center" title="撮影場所"
                                      style="width: 1rem"></span>
                                (xx.xxxx, xx.xxxx) <!-- TODO: 逆引きする？ -->
                            </p>
                        </div>
                    </div>
                </div>
                <div id="new-photo" class="card mb-1">
                    <div class="row" style="height: 9rem">
                        <div id="select-photo-button" class="col d-flex h-100 text-center text-muted bg-light">
                            <p class="m-auto">
                                <span class="far fa-image font-size-4x"></span><br />
                                タップして写真を選択
                            </p>
                        </div>
                        <div id="selected-photo-area" class="col d-none h-100 text-center">
                            <img src="20181104_003_small.jpg" id="selected-photo" class="img-keep-ratio m-auto"/>
                        </div>
                        <input type="file" id="file-input" class="d-none" tabindex="-1" />
                        <div class="photo-property-form col h-100 d-none">
                            <div class="w-100 m-auto">
                                <div class="input-group my-1 pr-1">
                                    <label for="photo-taken-date" class="input-group-prepend input-group-text">
                                        <span class="fas fa-clock" title="撮影日時" style="width:1rem"></span>
                                    </label>
                                    <input type="datetime-local" id="photo-taken-date" class="form-control"
                                           value="2018-01-01T12:00"/>
                                </div>
                                <p class="input-group my-1 pr-1">
                                    <label for="photo-taken-location" class="input-group-prepend input-group-text">
                                        <span class="fas fa-map-marker-alt" title="撮影場所" style="width:1rem"></span>
                                    </label>
                                    <input type="text" id="photo-taken-location" class="form-control"
                                           placeholder="xx.xxxx, xx.xxxx"/>
                                    <!-- TODO: 逆引きする？ -->
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col photo-property-form d-none mx-1">
                            <textarea class="form-control photo-description mb-1" rows="5"
                                      placeholder="写真の説明"></textarea>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="reset" id="reset-photo-button" class="btn btn-secondary">
                            <span class="fas fa-eraser"></span> リセット
                        </button>
                        <button type="button" id="add-photo-button" class="btn btn-primary float-right">
                            <span class="fas fa-plus"></span> 追加
                        </button>
                    </div>
                </div>
            </div>

            <div class="card mb-5">
                <h5 class="card-header card-title">旅程地図プレビュー</h5>
                <div id="map-preview" class="card-body"></div>
            </div>
        </div>
    </div>

</main>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAeH3QEuI3KqOwBkkjJ6nYe-jQBTWGDQdw&callback=initMap" async
        defer></script>
</body>

</html>
